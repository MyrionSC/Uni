package main;
public class CarAlarmSystem implements ICarAlarmSystem {
	public doorState door = doorState.opened;
	public boolean alarmFlashing = false;
	public boolean alarmSound = false;
	public boolean alarmArmed = false;
	public java.util.Timer alarmSoundingTimer;
	public java.util.Timer alarmFlashingTimer;
	public java.util.Timer alarmArmedTimer;
	
	public void openDoor () {
		}
	public void unlockDoor () {

	}
	public void printState () {
		System.out.println("door state: " + door.toString());
		System.out.println("alarm armed: " + alarmArmed);
		System.out.println("flashing " + alarmFlashing);
		System.out.println("souding " + alarmSound);
		System.out.println("-");
	}
	@Override
	public void lock() {
		
	}
	@Override
	public void unlock() {
		alarmSound = false;
		alarmFlashing = false;
		alarmArmed = false;
		alarmSoundingTimer.cancel();
		alarmFlashingTimer.cancel();
		alarmArmedTimer.cancel();
	}
	@Override
	public void close() {
		// turn armed after 2 sec
		alarmArmedTimer = new java.util.Timer();
		alarmArmedTimer.schedule( 
		        new java.util.TimerTask() {
		            @Override
		            public void run() {
		                alarmArmed = true;
		            }
		        },
		        2000
		);
		door = doorState.closed;
	}
	@Override
	public void open() {
		door = doorState.opened;
		if (alarmArmed && door == doorState.locked) {
			// make noise for 3 seconds
			alarmSound = true;
			alarmSoundingTimer = new java.util.Timer();
			alarmSoundingTimer.schedule( 
			        new java.util.TimerTask() {
			            @Override
			            public void run() {
			                alarmSound = false;
			            }
			        }, 
			        3000
			);
			
			// flash for 30 seconds
			alarmFlashing = true;
			alarmFlashingTimer = new java.util.Timer();
			alarmFlashingTimer.schedule( 
			        new java.util.TimerTask() {
			            @Override
			            public void run() {
			                alarmFlashing = false;
			            }
			        }, 
			        30000
			);
		} else {
			alarmArmed = false;
		}
	}
}
